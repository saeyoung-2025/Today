<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´ ì•± (Todo, Diary, Budget í†µí•©)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /*
         * -------------------------------------------------------------------------
         * ê¸°ë³¸ ìŠ¤íƒ€ì¼
         * -------------------------------------------------------------------------
         */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            color: #333;
        }
        .app-container {
            width: 100%;
            max-width: 420px;
            min-height: 100vh;
            background: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            padding: 20px 0;
            box-sizing: border-box;
            transition: background-color 0.3s;
        }
        header {
            text-align: center;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        h1 {
            font-size: 1.5em;
            font-weight: 700;
            margin: 0;
            color: var(--primary-color, #1a73e8);
        }
        .page {
            padding: 0 20px;
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100vh;
            box-sizing: border-box;
            background-color: var(--background-color, #fff);
            overflow-y: auto;
            padding-bottom: 80px; /* í‘¸í„° ê³µê°„ í™•ë³´ */
        }
        .page.active {
            display: block;
            z-index: 10;
        }
        .section-title {
            font-size: 1.2em;
            font-weight: 700;
            margin: 25px 0 10px;
            color: var(--secondary-color, #555);
            border-bottom: 2px solid var(--secondary-color, #555);
            padding-bottom: 5px;
        }
        button, input[type="submit"] {
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.2s, transform 0.1s;
        }
        button:active {
            transform: scale(0.98);
        }

        /*
         * -------------------------------------------------------------------------
         * í…Œë§ˆ ì„¤ì • (Custom Properties)
         * -------------------------------------------------------------------------
         */
        .theme-yellow {
            --primary-color: #FFC107; /* ì•°ë²„ */
            --secondary-color: #FFA000; /* ë‹¤í¬ ì•°ë²„ */
            --background-color: #FFFDE7; /* ì—°í•œ ë…¸ë‘ */
            --card-background: #FFF8E1; /* ë” ì—°í•œ ë…¸ë‘ */
            --text-color: #424242;
            --main-btn-bg: #FFEB3B;
            --main-btn-hover: #FDD835;
        }
        .theme-blue {
            --primary-color: #2196F3; /* ë¸”ë£¨ */
            --secondary-color: #1976D2; /* ë‹¤í¬ ë¸”ë£¨ */
            --background-color: #E3F2FD; /* ì—°í•œ í•˜ëŠ˜ìƒ‰ */
            --card-background: #BBDEFB;
            --text-color: #333;
            --main-btn-bg: #4CAF50;
            --main-btn-hover: #43A047;
        }
        .theme-pink {
            --primary-color: #E91E63; /* í•‘í¬ */
            --secondary-color: #C2185B; /* ë‹¤í¬ í•‘í¬ */
            --background-color: #FCE4EC; /* ì—°í•œ í•‘í¬ */
            --card-background: #F8BBD0;
            --text-color: #333;
            --main-btn-bg: #FF4081;
            --main-btn-hover: #F50057;
        }

        /*
         * -------------------------------------------------------------------------
         * ë©”ì¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼
         * -------------------------------------------------------------------------
         */
        #mainPage {
            position: relative;
        }
        .theme-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px 0;
            margin-bottom: 20px;
        }
        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #ccc;
            opacity: 0.7;
            transition: all 0.2s;
            position: relative;
        }
        .theme-btn.active {
            border-width: 4px;
            opacity: 1;
            border-color: var(--primary-color);
        }
        .theme-btn[data-theme="yellow"] { background-color: #FFC107; }
        .theme-btn[data-theme="blue"] { background-color: #2196F3; }
        .theme-btn[data-theme="pink"] { background-color: #E91E63; }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        .card {
            background-color: var(--card-background);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }
        .card-icon {
            font-size: 2.5em;
            margin-bottom: 5px;
        }
        .card-title {
            font-size: 1.2em;
            font-weight: 700;
            margin: 5px 0;
            color: var(--primary-color);
        }
        .card-points {
            font-size: 0.9em;
            color: var(--text-color);
            opacity: 0.7;
        }

        /*
         * -------------------------------------------------------------------------
         * TODO LIST ìŠ¤íƒ€ì¼
         * -------------------------------------------------------------------------
         */
        #todoPage .header-info {
            background: var(--card-background);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        #todoPage .header-info div {
            margin: 5px 0;
            font-weight: 400;
        }
        .grade-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 700;
            margin-left: 5px;
        }
        .grade-s { background-color: gold; color: #333; }
        .grade-a { background-color: #4CAF50; color: #fff; }
        .grade-b { background-color: #FF9800; color: #fff; }
        .grade-c { background-color: #795548; color: #fff; }
        .grade-d { background-color: #9E9E9E; color: #fff; }
        .grade-f { background-color: #F44336; color: #fff; }

        .new-task-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        #newTask {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        #addTaskBtn {
            background-color: var(--primary-color);
            color: #fff;
            padding: 10px 15px;
        }

        .task {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .task:last-child {
            border-bottom: none;
        }
        .task input[type="checkbox"] {
            margin-right: 15px;
            min-width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .task-text {
            flex-grow: 1;
            font-size: 1.05em;
        }
        .point {
            font-weight: 700;
            color: var(--secondary-color);
            margin-right: 10px;
            white-space: nowrap;
        }
        .delete-btn {
            background: none;
            padding: 5px;
            font-size: 0.8em;
            color: #F44336;
        }
        .reset-btn {
            background-color: #9E9E9E;
            color: #fff;
            width: 100%;
            margin-top: 20px;
        }

        /*
         * -------------------------------------------------------------------------
         * DIARY ìŠ¤íƒ€ì¼
         * -------------------------------------------------------------------------
         */
        .diary-write-section {
            background: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        .diary-write-section input[type="text"],
        .diary-write-section textarea,
        .diary-write-section select {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
        }
        .diary-write-section textarea {
            height: 100px;
            resize: vertical;
        }
        .diary-controls {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        #saveDiaryBtn {
            background-color: var(--primary-color);
            color: #fff;
        }
        #cancelEditBtn {
            background-color: #9E9E9E;
            color: #fff;
            display: none;
        }

        .diary-card {
            background-color: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        .diary-card-date {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        .diary-card-title {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        .diary-card-preview {
            font-size: 0.95em;
            color: #555;
            margin-bottom: 10px;
        }
        .diary-card-buttons .diary-btn {
            background: #f0f0f0;
            color: #333;
            padding: 5px 10px;
            font-size: 0.85em;
            margin-right: 5px;
        }
        .diary-btn-view { background-color: var(--main-btn-bg); color: #fff; }
        .diary-btn-delete { background-color: #F44336; color: #fff; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .diary-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .diary-modal.show {
            display: flex;
        }
        .modal-content {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        #modalDate {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 10px;
        }
        #modalTitle {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        #modalText {
            white-space: pre-wrap;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .modal-close-btn {
            background-color: var(--secondary-color);
            color: #fff;
            float: right;
        }

        /*
         * -------------------------------------------------------------------------
         * BUDGET ìŠ¤íƒ€ì¼
         * -------------------------------------------------------------------------
         */
        .balance-card {
            background: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }
        .balance-card .current-balance {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
        }
        #currentBalanceAmount {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--primary-color);
        }
        .summary-row {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .summary-item {
            text-align: center;
        }
        .summary-item-label {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 3px;
        }
        #totalIncomeAmount { color: #4CAF50; font-weight: 700; }
        #totalExpenseAmount { color: #F44336; font-weight: 700; }

        .transaction-form {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        .transaction-form .radio-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        .radio-group input[type="radio"] { display: none; }
        .radio-group label {
            padding: 8px 15px;
            border: 2px solid #ccc;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .radio-group input[type="radio"]:checked + label.income-label { border-color: #4CAF50; background-color: #E8F5E9; color: #4CAF50; }
        .radio-group input[type="radio"]:checked + label.expense-label { border-color: #F44336; background-color: #FFEBEE; color: #F44336; }

        .transaction-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .transaction-input-group input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            flex-grow: 1;
        }
        /* [ìˆ˜ì •] ë²„íŠ¼ì„ í¼ ì „ì²´ ë„ˆë¹„ë¡œ í™•ì¥í•˜ì—¬ ëª…í™•í•˜ê²Œ ë³´ì´ë„ë¡ í•¨ */
        #addTransactionBtn {
            background-color: var(--primary-color);
            color: #fff;
            width: 100%;
            padding: 12px;
            margin-top: 10px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .history-item:last-child { border-bottom: none; }
        .history-info {
            flex-grow: 1;
        }
        .history-date {
            font-size: 0.8em;
            color: #999;
        }
        .history-memo {
            font-size: 1em;
            font-weight: 500;
        }
        .history-amount {
            font-weight: 700;
            margin-right: 10px;
        }
        .history-amount.income { color: #4CAF50; }
        .history-amount.expense { color: #F44336; }
        .history-item .delete-btn {
             background: none;
             padding: 5px;
             font-size: 0.9em;
             color: #F44336;
        }

        /* ì°¨íŠ¸ ìŠ¤íƒ€ì¼ */
        .chart-section {
            padding: 15px;
            background: var(--card-background);
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }
        #budgetChartContainer {
            height: 200px; /* ì°¨íŠ¸ ë†’ì´ ê³ ì • */
            width: 100%;
            margin: 10px 0;
            position: relative;
        }
        .chart-canvas {
            width: 100%;
            height: 100%;
        }
        #chartLabels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7em;
            color: #777;
            padding: 0 5px;
        }

        /*
         * -------------------------------------------------------------------------
         * ê³µí†µ: í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜ ë° ì•Œë¦¼
         * -------------------------------------------------------------------------
         */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 420px;
            background: #fff;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 50;
        }
        .nav-btn {
            background: none;
            color: #999;
            font-size: 0.75em;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px 10px;
            font-weight: 400;
        }
        .nav-btn.active {
            color: var(--primary-color);
            font-weight: 700;
        }
        .nav-btn i {
            font-size: 1.5em;
            margin-bottom: 3px;
        }

        /* Toast ì•Œë¦¼ */
        .toast {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }
        .toast.info { background-color: #2196F3; }
        .toast.success { background-color: #4CAF50; }
        .toast.warning { background-color: #FF9800; }
        .toast.error { background-color: #F44336; }

        /* Confirmation Dialog */
        #confirmDialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        #confirmDialog.show {
            opacity: 1;
            pointer-events: all;
        }
        .confirm-content {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            width: 80%;
            max-width: 300px;
        }
        #confirmMessage {
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 500;
        }
        .confirm-buttons {
            display: flex;
            justify-content: space-around;
        }
        .confirm-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
        }
        #confirmYes { background-color: #4CAF50; color: #fff; }
        #confirmNo { background-color: #E0E0E0; color: #333; }
        .confirm-btn-yes { background-color: #F44336 !important; }
        
        .empty-message {
            text-align: center;
            color: #999;
            padding: 30px 0;
            background: #f9f9f9;
            border-radius: 8px;
            margin-top: 20px;
        }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div id="appContainer" class="app-container theme-yellow">
        <div id="mainPage" class="page active">
            <header>
                <h1>âœ¨ ë‚˜ì˜ ë°ì´ ì•± âœ¨</h1>
            </header>

            <div class="theme-selector">
                <button class="theme-btn" data-theme="yellow" onclick="changeTheme('yellow')" title="ë…¸ë€ìƒ‰ í…Œë§ˆ"></button>
                <button class="theme-btn" data-theme="blue" onclick="changeTheme('blue')" title="íŒŒë€ìƒ‰ í…Œë§ˆ"></button>
                <button class="theme-btn" data-theme="pink" onclick="changeTheme('pink')" title="í•‘í¬ìƒ‰ í…Œë§ˆ"></button>
            </div>

            <div class="main-grid">
                <div class="card" onclick="goToPage('todoPage')">
                    <div class="card-icon">ğŸ¯</div>
                    <div class="card-title">ì˜¤ëŠ˜ì˜ í•  ì¼ (TODO)</div>
                    <div class="card-points">â­ 0 / 0P</div>
                </div>
                <div class="card" onclick="goToPage('diaryPage')">
                    <div class="card-icon">ğŸ“</div>
                    <div class="card-title">ë‚˜ì˜ ì¼ê¸°ì¥ (DIARY)</div>
                    <div class="card-points">ğŸ“– 0ê°œ ê¸°ë¡</div>
                </div>
                <div class="card" onclick="goToPage('budgetPage')">
                    <div class="card-icon">ğŸ’°</div>
                    <div class="card-title">ê°€ê³„ë¶€ (BUDGET)</div>
                    <div class="card-points">ğŸ’µ 0ì›</div>
                </div>
            </div>
        </div>

        <div id="todoPage" class="page">
            <header>
                <h1>ğŸ¯ ì˜¤ëŠ˜ì˜ í•  ì¼ ê´€ë¦¬</h1>
            </header>

            <div class="header-info">
                <div id="currentDateTime">ğŸ“… 2024ë…„ 11ì›” 16ì¼ í† ìš”ì¼</div>
                <div id="currentScore">í˜„ì¬ ë‚˜ì˜ ì ìˆ˜: 0P</div>
                <div id="currentGrade">ì˜¤ëŠ˜ì˜ ë“±ê¸‰: F âŒ</div>
            </div>

            <div class="new-task-form">
                <input type="text" id="newTask" placeholder="ìƒˆë¡œìš´ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                <button id="addTaskBtn" onclick="addTask()">ì¶”ê°€</button>
            </div>

            <div class="section-title">í•  ì¼ ëª©ë¡</div>
            <div id="taskList">
                <div class="empty-message">ë“±ë¡ëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>

            <button class="reset-btn" onclick="resetAllTasks()">ëª¨ë‘ ì´ˆê¸°í™”í•˜ê³  ìƒˆë¡œìš´ í•˜ë£¨ ì‹œì‘</button>
            <button class="reset-btn" style="background-color: #B0BEC5;" onclick="showResetInfo()">ìë™ ì´ˆê¸°í™” ì •ë³´</button>
        </div>

        <div id="diaryPage" class="page">
            <header>
                <h1>ğŸ“ ë‚˜ì˜ ì¼ê¸°ì¥</h1>
            </header>
            
            <div class="diary-write-section">
                <div class="section-title" style="margin-top: 0;">ì¼ê¸° ì‘ì„±</div>
                <input type="text" id="diaryTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                <textarea id="diaryContent" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ê¸°ë¡í•´ ë³´ì„¸ìš”..."></textarea>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <label for="diaryMood">ì˜¤ëŠ˜ì˜ ê¸°ë¶„:</label>
                    <select id="diaryMood">
                        <option value="ğŸ˜Š">ğŸ˜Š ì¢‹ìŒ</option>
                        <option value="ğŸ˜ƒ">ğŸ˜ƒ ë§¤ìš° ì¢‹ìŒ</option>
                        <option value="ğŸ™">ğŸ™ ìŠ¬í””</option>
                        <option value="ğŸ˜¡">ğŸ˜¡ í™”ë‚¨</option>
                        <option value="ğŸ˜">ğŸ˜ ë³´í†µ</option>
                    </select>
                </div>
                <div class="diary-controls">
                    <button id="cancelEditBtn" onclick="clearDiaryForm()">ì·¨ì†Œ</button>
                    <button id="saveDiaryBtn" onclick="saveDiary()">ìƒˆ ì¼ê¸° ì €ì¥</button>
                </div>
            </div>

            <div class="section-title">ìµœê·¼ ì¼ê¸° ëª©ë¡</div>
            <div id="diaryList">
                <div class="empty-message">ì‘ì„±ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì„ ê¸°ë¡í•´ ë³´ì„¸ìš”!</div>
            </div>
        </div>

        <div id="diaryModal" class="diary-modal" onclick="closeDiaryModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div id="modalDate"></div>
                <h3 id="modalTitle"></h3>
                <p id="modalText"></p>
                <button class="modal-close-btn" onclick="closeDiaryModal()">ë‹«ê¸°</button>
            </div>
        </div>

        <div id="budgetPage" class="page">
            <header>
                <h1>ğŸ’° ê°€ê³„ë¶€ (ìˆ˜ì…/ì§€ì¶œ)</h1>
            </header>

            <div class="balance-card">
                <div class="current-balance">í˜„ì¬ ì”ì•¡</div>
                <div id="currentBalanceAmount">0ì›</div>
                <div class="summary-row">
                    <div class="summary-item">
                        <div class="summary-item-label">ì´ ìˆ˜ì…</div>
                        <div id="totalIncomeAmount">+0ì›</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">ì´ ì§€ì¶œ</div>
                        <div id="totalExpenseAmount">-0ì›</div>
                    </div>
                </div>
            </div>

            <div class="section-title">ê±°ë˜ ë‚´ì—­ ì¶”ê°€</div>
            <div class="transaction-form">
                <div class="radio-group">
                    <input type="radio" id="income" name="transactionType" value="income" checked>
                    <label for="income" class="income-label">ìˆ˜ì…</label>
                    
                    <input type="radio" id="expense" name="transactionType" value="expense">
                    <label for="expense" class="expense-label">ì§€ì¶œ</label>
                </div>

                <div class="transaction-input-group">
                    <input type="number" id="transactionAmount" placeholder="ê¸ˆì•¡ (ì›)">
                    <input type="text" id="transactionMemo" placeholder="ë©”ëª¨ (ì‚¬ìš©ì²˜/ì¶œì²˜)">
                </div>
                <button id="addTransactionBtn" onclick="addBudgetItem()">ê±°ë˜ ê¸°ë¡</button>
            </div>

            <div class="section-title">ìµœê·¼ ì§€ì¶œ/ìˆ˜ì… í˜„í™© (7ì¼)</div>
            <div class="chart-section">
                <div id="budgetChartContainer">
                    </div>
                <div id="chartLabels">
                    </div>
            </div>
            
            <div class="section-title">ìµœê·¼ ê±°ë˜ ë‚´ì—­</div>
            <div id="historyList">
                <div class="empty-message">ê¸°ë¡ëœ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>


        <div class="footer-nav">
            <button class="nav-btn active" onclick="goToPage('mainPage')">
                <i class="fas fa-home"></i>
                í™ˆ
            </button>
            <button class="nav-btn" onclick="goToPage('todoPage')">
                <i class="fas fa-check-square"></i>
                í•  ì¼
            </button>
            <button class="nav-btn" onclick="goToPage('diaryPage')">
                <i class="fas fa-book-open"></i>
                ì¼ê¸°
            </button>
            <button class="nav-btn" onclick="goToPage('budgetPage')">
                <i class="fas fa-wallet"></i>
                ê°€ê³„ë¶€
            </button>
        </div>

        <div id="confirmDialog">
            <div class="confirm-content">
                <div id="confirmMessage">ì •ë§ë¡œ ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
                <div class="confirm-buttons">
                    <button id="confirmNo" class="confirm-btn">ì•„ë‹ˆì˜¤</button>
                    <button id="confirmYes" class="confirm-btn confirm-btn-yes">ì˜ˆ</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // -------------------------------------------------------------------------
        // 1. ìƒíƒœ ê´€ë¦¬ (State Management)
        // -------------------------------------------------------------------------

        const STORAGE_KEY = {
            THEME: 'day_app_theme',
            TASKS: 'day_app_tasks',
            SCORE: 'day_app_score',
            DIARIES: 'day_app_diaries',
            BUDGET: 'day_app_budget',
        };

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³ , ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
        let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY.TASKS)) || [
            { id: 1, text: 'AI ì¼ë°˜ ê³µë¶€í•˜ê¸°', done: false, points: 20 },
            { id: 2, text: 'ìš”ë¦¬í•˜ê¸°', done: false, points: 20 },
            { id: 3, text: '30ë¶„ ì´ìƒ ë…ì„œí•˜ê¸°', done: false, points: 30 }
        ];

        let currentScore = JSON.parse(localStorage.getItem(STORAGE_KEY.SCORE)) || 0;
        let diaries = JSON.parse(localStorage.getItem(STORAGE_KEY.DIARIES)) || [];
        let budgetHistory = JSON.parse(localStorage.getItem(STORAGE_KEY.BUDGET)) || [];

        const pageIds = ['mainPage', 'todoPage', 'diaryPage', 'budgetPage'];
        
        // -------------------------------------------------------------------------
        // 2. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // -------------------------------------------------------------------------

        /** ë°ì´í„°ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•©ë‹ˆë‹¤. */
        function saveState() {
            localStorage.setItem(STORAGE_KEY.TASKS, JSON.stringify(tasks));
            localStorage.setItem(STORAGE_KEY.SCORE, JSON.stringify(currentScore));
            localStorage.setItem(STORAGE_KEY.DIARIES, JSON.stringify(diaries));
            localStorage.setItem(STORAGE_KEY.BUDGET, JSON.stringify(budgetHistory));
            updateMainCardPoints();
        }

        /** í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. */
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // í† ìŠ¤íŠ¸ê°€ ë‚˜íƒ€ë‚˜ë„ë¡ opacityì™€ bottom ìœ„ì¹˜ ë³€ê²½
            requestAnimationFrame(() => {
                 toast.style.opacity = 1;
                 toast.style.bottom = '70px';
            });
            
            setTimeout(() => {
                // í† ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
                toast.style.opacity = 0;
                toast.style.bottom = '50px';
                // ì™„ì „íˆ ì‚¬ë¼ì§„ í›„ DOMì—ì„œ ì œê±°
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        /** í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. */
        function showConfirmDialog(message, callback, isDestructive = false) {
            const dialog = document.getElementById('confirmDialog');
            document.getElementById('confirmMessage').textContent = message;
            
            const yesBtn = document.getElementById('confirmYes');
            const noBtn = document.getElementById('confirmNo');

            // íŒŒê´´ì ì¸ ì‘ì—…(ì‚­ì œ ë“±)ì¸ ê²½ìš° ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½
            yesBtn.classList.remove('confirm-btn-yes');
            if (isDestructive) {
                yesBtn.classList.add('confirm-btn-yes');
            }

            const onYes = () => {
                callback(true);
                dialog.classList.remove('show');
                yesBtn.removeEventListener('click', onYes);
                noBtn.removeEventListener('click', onNo);
            };
            const onNo = () => {
                callback(false);
                dialog.classList.remove('show');
                yesBtn.removeEventListener('click', onYes);
                noBtn.removeEventListener('click', onNo);
            };
            
            // ì´ì „ì— ë“±ë¡ëœ ë¦¬ìŠ¤ë„ˆê°€ ìˆë‹¤ë©´ ì œê±°í•˜ê³  ìƒˆë¡œ ë“±ë¡
            yesBtn.replaceWith(yesBtn.cloneNode(true));
            noBtn.replaceWith(noBtn.cloneNode(true));
            
            document.getElementById('confirmYes').addEventListener('click', onYes);
            document.getElementById('confirmNo').addEventListener('click', onNo);
            
            dialog.classList.add('show');
        }

        // -------------------------------------------------------------------------
        // 3. í˜ì´ì§€ ë° í…Œë§ˆ ê´€ë¦¬
        // -------------------------------------------------------------------------

        /** í˜ì´ì§€ë¥¼ ì „í™˜í•©ë‹ˆë‹¤. */
        function goToPage(pageId) {
            pageIds.forEach(id => {
                const page = document.getElementById(id);
                const navBtn = document.querySelector(`.nav-btn[onclick="goToPage('${id}')"]`);
                
                if (page) {
                    page.classList.remove('active');
                }
                if (navBtn) {
                    navBtn.classList.remove('active');
                }
            });
            
            const targetPage = document.getElementById(pageId);
            const targetNavBtn = document.querySelector(`.nav-btn[onclick="goToPage('${pageId}')"]`);

            if (targetPage) {
                targetPage.classList.add('active');
                if (targetNavBtn) {
                    targetNavBtn.classList.add('active');
                }
                
                // íŠ¹ì • í˜ì´ì§€ë¡œ ì´ë™ ì‹œ í•´ë‹¹ í˜ì´ì§€ì˜ ë Œë”ë§ í•¨ìˆ˜ë¥¼ í˜¸ì¶œ
                if (pageId === 'mainPage') updateMainCardPoints();
                if (pageId === 'todoPage') renderTaskList();
                if (pageId === 'diaryPage') renderDiaryList();
                if (pageId === 'budgetPage') renderBudgetPage();

                // í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
                targetPage.scrollTo(0, 0);
            }
        }

        /** í˜„ì¬ í…Œë§ˆë¥¼ ë¡œë“œí•˜ê³  ë²„íŠ¼ì— ì ìš©í•©ë‹ˆë‹¤. */
        function loadTheme() {
            const appContainer = document.getElementById('appContainer');
            const savedTheme = localStorage.getItem(STORAGE_KEY.THEME) || 'theme-yellow';
            
            // 1. ì»¨í…Œì´ë„ˆì— í´ë˜ìŠ¤ ì ìš©
            appContainer.className = 'app-container ' + savedTheme;

            // 2. í…Œë§ˆ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ê°±ì‹ 
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === savedTheme.replace('theme-', '')) {
                    btn.classList.add('active');
                }
            });
        }

        /** í…Œë§ˆë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. */
        function changeTheme(themeName) {
            const fullThemeName = `theme-${themeName}`;
            localStorage.setItem(STORAGE_KEY.THEME, fullThemeName);
            loadTheme();
            showToast(`í…Œë§ˆê°€ ${themeName.toUpperCase()}ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
        }
        
        /** ë©”ì¸ í˜ì´ì§€ ì¹´ë“œ ì ìˆ˜ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤. */
        function updateMainCardPoints() {
            const totalTaskPoints = tasks.reduce((sum, t) => sum + t.points, 0);
            document.querySelector('#mainPage .card:nth-child(1) .card-points').textContent = `â­ ${currentScore} / ${totalTaskPoints}P`;
            document.querySelector('#mainPage .card:nth-child(2) .card-points').textContent = `ğŸ“– ${diaries.length}ê°œ ê¸°ë¡`;
            const totalIncome = budgetHistory.filter(item => item.type === 'income').reduce((sum, item) => sum + item.amount, 0);
            const totalExpense = budgetHistory.filter(item => item.type === 'expense').reduce((sum, item) => sum + item.amount, 0);
            const currentBalance = totalIncome - totalExpense;
            document.querySelector('#mainPage .card:nth-child(3) .card-points').textContent = `ğŸ’µ ${currentBalance.toLocaleString('ko-KR')}ì›`;
        }


        // -------------------------------------------------------------------------
        // 4. TODO LIST ë¡œì§
        // -------------------------------------------------------------------------

        /** í•  ì¼ ëª©ë¡ì„ í™”ë©´ì— ë Œë”ë§í•©ë‹ˆë‹¤. */
        function renderTaskList() {
            const taskListEl = document.getElementById('taskList');
            if (!taskListEl) return;
            taskListEl.innerHTML = '';
            
            if (tasks.length === 0) {
                 taskListEl.innerHTML = '<div class="empty-message">ë“±ë¡ëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            tasks.forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = 'task';
                taskEl.setAttribute('data-id', task.id);
                
                // í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼
                const textStyle = task.done 
                    ? 'text-decoration: line-through; color: #999;' 
                    : 'text-decoration: none; color: var(--text-color);';

                taskEl.innerHTML = `
                    <input type="checkbox" onchange="toggleTask(${task.id})" ${task.done ? 'checked' : ''}>
                    <span class="task-text" style="${textStyle}">${task.text}</span>
                    <span class="point">${task.points}ì </span>
                    <button class="delete-btn" onclick="deleteTask(${task.id})">ğŸ—‘ï¸</button>
                `;
                taskListEl.appendChild(taskEl);
            });
            updateScore(false); // í™”ë©´ ë Œë”ë§ ì‹œ ì ìˆ˜ë„ ê°±ì‹ 
            updateDateTimeDisplay();
        }
        
        /** ìƒˆ í•  ì¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤. */
        function addTask() {
            const newTaskInput = document.getElementById('newTask');
            const text = newTaskInput.value.trim();
            if (text === '') {
                showToast('í•  ì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            const newId = tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1;
            const newPoints = 20; // ê¸°ë³¸ 20ì  ì„¤ì • (ì‚¬ìš©ì ì…ë ¥ ê¸°ëŠ¥ì€ ì œì™¸)
            
            tasks.push({ id: newId, text: text, done: false, points: newPoints });
            
            newTaskInput.value = '';
            saveState();
            renderTaskList();
            showToast('ìƒˆ í•  ì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
        
        /** í•  ì¼ ì™„ë£Œ ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤. */
        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.done = !task.done;
                saveState();
                renderTaskList();
                
                if (task.done) {
                    showToast(`[${task.text}] ì™„ë£Œ! ${task.points}ì  íšë“! ğŸ‰`, 'success');
                } else {
                    showToast(`[${task.text}] ì·¨ì†Œ... ì ìˆ˜ê°€ ì°¨ê°ë©ë‹ˆë‹¤. ğŸ˜¥`, 'error');
                }
            }
        }
        
        /** í•  ì¼ì„ ëª©ë¡ì—ì„œ ì‚­ì œí•©ë‹ˆë‹¤. */
        function deleteTask(id) {
            showConfirmDialog(`ì •ë§ë¡œ ì´ í•  ì¼ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì ìˆ˜ëŠ” ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤)`, (confirmed) => {
                if (confirmed) {
                    tasks = tasks.filter(t => t.id !== id);
                    saveState();
                    renderTaskList();
                    showToast('í•  ì¼ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }, true);
        }
        
        /** í˜„ì¬ ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ê³  í™”ë©´ì— ê°±ì‹ í•©ë‹ˆë‹¤. */
        function updateScore(shouldSave = true) {
            const completedTasks = tasks.filter(t => t.done);
            currentScore = completedTasks.reduce((total, t) => total + t.points, 0);
            
            const scoreEl = document.getElementById('currentScore');
            if (scoreEl) {
                scoreEl.textContent = `í˜„ì¬ ë‚˜ì˜ ì ìˆ˜: ${currentScore}P`;
            }
            
            const gradeEl = document.getElementById('currentGrade');
            if (gradeEl) {
                const { grade, emoji } = getGrade(currentScore);
                gradeEl.innerHTML = `ì˜¤ëŠ˜ì˜ ë“±ê¸‰: <span class="grade-badge grade-${grade.toLowerCase()}">${grade} ${emoji}</span>`;
            }

            if (shouldSave) saveState();
        }
        
        /** ì ìˆ˜ì— ë”°ë¥¸ ë“±ê¸‰ì„ ê³„ì‚°í•©ë‹ˆë‹¤. */
        function getGrade(score) {
            if (score >= 100) return { grade: 'S', emoji: 'ğŸŒŸ' };
            if (score >= 80) return { grade: 'A', emoji: 'âœ…' };
            if (score >= 60) return { grade: 'B', emoji: 'ğŸ˜Š' };
            if (score >= 40) return { grade: 'C', emoji: 'ğŸ˜' };
            if (score >= 20) return { grade: 'D', emoji: 'ğŸ˜Ÿ' };
            return { grade: 'F', emoji: 'âŒ' };
        }
        
        /** í˜„ì¬ ë‚ ì§œ ë° ì‹œê°„ì„ í‘œì‹œí•©ë‹ˆë‹¤. */
        function updateDateTimeDisplay() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            const dateString = now.toLocaleDateString('ko-KR', options);
            
            const timeDisplayEl = document.getElementById('currentDateTime');
            if (timeDisplayEl) {
                timeDisplayEl.textContent = `ğŸ“… ${dateString}`;
            }
        }

        /** í•  ì¼ ëª©ë¡ ì´ˆê¸°í™” ì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. */
        function showResetInfo() {
            showToast('í•  ì¼ ëª©ë¡ì€ ì›ë˜ ë§¤ì¼ ìì •(00:00)ì— ìë™ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆì€ ìˆ˜ë™ ì´ˆê¸°í™” ë²„íŠ¼ì„ ì‚¬ìš©í•´ ì£¼ì„¸ìš”!', 'info');
        }

        /** í•  ì¼ ëª©ë¡ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. */
        function resetAllTasks() {
             showConfirmDialog(`í•  ì¼ ëª©ë¡ì„ ì •ë§ë¡œ ì´ˆê¸°í™”í•˜ê³  ì ìˆ˜ë¥¼ 0ìœ¼ë¡œ ì¬ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, (confirmed) => {
                if (confirmed) {
                    tasks = [];
                    currentScore = 0;
                    saveState();
                    renderTaskList();
                    showToast('í•  ì¼ ëª©ë¡ì´ ì™„ì „íˆ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ í•˜ë£¨ë¥¼ ì‹œì‘í•˜ì„¸ìš”!', 'warning');
                }
            }, true);
        }
        
        // -------------------------------------------------------------------------
        // 5. DIARY (ì¼ê¸°ì¥) ë¡œì§
        // -------------------------------------------------------------------------

        let currentDiaryId = null; // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ ID ì €ì¥

        /** ì¼ê¸°ì¥ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. */
        function renderDiaryList() {
            renderDiaryTable(diaries.slice().reverse()); // ìµœì‹ ìˆœìœ¼ë¡œ ë Œë”ë§
            clearDiaryForm(); // í•­ìƒ í¼ ì´ˆê¸°í™”
        }
        
        /** ì¼ê¸°ì¥ í…Œì´ë¸”ì„ ë Œë”ë§í•©ë‹ˆë‹¤. */
        function renderDiaryTable(list) {
            const diaryListEl = document.getElementById('diaryList');
            if (!diaryListEl) return;
            
            diaryListEl.innerHTML = '';

            if (list.length === 0) {
                diaryListEl.innerHTML = '<div class="empty-message">ì‘ì„±ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì„ ê¸°ë¡í•´ ë³´ì„¸ìš”!</div>';
                return;
            }

            list.forEach(diary => {
                const diaryCard = document.createElement('div');
                diaryCard.className = 'diary-card';
                diaryCard.innerHTML = `
                    <div class="diary-card-date">${diary.date} <span class="mood-emoji">${diary.mood}</span></div>
                    <div class="diary-card-title">${diary.title}</div>
                    <div class="diary-card-preview">${diary.content.substring(0, 100).replace(/\n/g, ' ')}...</div>
                    <div class="diary-card-buttons">
                        <button class="diary-btn diary-btn-view" onclick="viewDiary(${diary.id})">ë³´ê¸°</button>
                        <button class="diary-btn diary-btn-edit" onclick="editDiary(${diary.id})">ìˆ˜ì •</button>
                        <button class="diary-btn diary-btn-delete" onclick="deleteDiary(${diary.id})">ì‚­ì œ</button>
                    </div>
                `;
                diaryListEl.appendChild(diaryCard);
            });
        }

        /** ì¼ê¸° ì‘ì„±/ìˆ˜ì • í¼ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. */
        function clearDiaryForm() {
            document.getElementById('diaryTitle').value = '';
            document.getElementById('diaryContent').value = '';
            document.getElementById('diaryMood').value = 'ğŸ˜Š';
            document.getElementById('saveDiaryBtn').textContent = 'ìƒˆ ì¼ê¸° ì €ì¥';
            document.getElementById('cancelEditBtn').style.display = 'none';
            currentDiaryId = null;
        }

        /** ì¼ê¸°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ìˆ˜ì •í•©ë‹ˆë‹¤. */
        function saveDiary() {
            const title = document.getElementById('diaryTitle').value.trim();
            const content = document.getElementById('diaryContent').value.trim();
            const mood = document.getElementById('diaryMood').value;
            const date = new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' });

            if (title === '' || content === '') {
                showToast('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            if (currentDiaryId) {
                // ìˆ˜ì • ëª¨ë“œ
                const index = diaries.findIndex(d => d.id === currentDiaryId);
                if (index !== -1) {
                    diaries[index] = { ...diaries[index], title, content, mood, date: new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' }) + ' (ìˆ˜ì •ë¨)' };
                    showToast('ì¼ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }
            } else {
                // ìƒˆ ì¼ê¸° ì‘ì„± ëª¨ë“œ
                const newId = diaries.length > 0 ? Math.max(...diaries.map(d => d.id)) + 1 : 1;
                diaries.push({ id: newId, title, content, mood, date });
                showToast('ìƒˆ ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }

            saveState();
            clearDiaryForm();
            renderDiaryList();
        }

        /** ì¼ê¸°ë¥¼ ìˆ˜ì • í¼ì— ë¡œë“œí•©ë‹ˆë‹¤. */
        function editDiary(id) {
            const diary = diaries.find(d => d.id === id);
            if (diary) {
                document.getElementById('diaryTitle').value = diary.title;
                document.getElementById('diaryContent').value = diary.content;
                document.getElementById('diaryMood').value = diary.mood;
                document.getElementById('saveDiaryBtn').textContent = 'ìˆ˜ì • ì™„ë£Œ';
                document.getElementById('cancelEditBtn').style.display = 'block';
                currentDiaryId = id;
                showToast('ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ë³€ê²½í•˜ì„¸ìš”.', 'info');
                document.getElementById('diaryPage').scrollTo(0, 0); // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
            }
        }
        
        /** ì¼ê¸°ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. */
        function viewDiary(id) {
            const diary = diaries.find(d => d.id === id);
            if (diary) {
                document.getElementById('modalDate').textContent = diary.date + ' ' + diary.mood;
                document.getElementById('modalTitle').textContent = diary.title;
                document.getElementById('modalText').textContent = diary.content;
                document.getElementById('diaryModal').classList.add('show');
            }
        }

        /** ì¼ê¸°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤. */
        function deleteDiary(id) {
            showConfirmDialog(`ì •ë§ë¡œ ì´ ì¼ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, (confirmed) => {
                if (confirmed) {
                    diaries = diaries.filter(d => d.id !== id);
                    saveState();
                    renderDiaryList();
                    showToast('ì¼ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }, true);
        }
        
        /** ì¼ê¸° ëª¨ë‹¬ì„ ë‹«ìŠµë‹ˆë‹¤. */
        function closeDiaryModal() {
            document.getElementById('diaryModal').classList.remove('show');
        }

        // -------------------------------------------------------------------------
        // 6. BUDGET (ê°€ê³„ë¶€) ë¡œì§
        // -------------------------------------------------------------------------
        
        /** ê°€ê³„ë¶€ í˜ì´ì§€ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. */
        function renderBudgetPage() {
            renderBalance();
            renderHistoryList();
            renderBudgetChart();
        }

        /** ì”ì•¡ ë° ìˆ˜ì…/ì§€ì¶œ í•©ê³„ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. */
        function renderBalance() {
            const totalIncome = budgetHistory.filter(item => item.type === 'income').reduce((sum, item) => sum + item.amount, 0);
            const totalExpense = budgetHistory.filter(item => item.type === 'expense').reduce((sum, item) => sum + item.amount, 0);
            const currentBalance = totalIncome - totalExpense;

            // ê¸ˆì•¡ í¬ë§·íŒ…
            const formatAmount = (amount) => amount.toLocaleString('ko-KR') + 'ì›';

            document.getElementById('totalIncomeAmount').textContent = `+${formatAmount(totalIncome)}`;
            document.getElementById('totalExpenseAmount').textContent = `-${formatAmount(totalExpense)}`;
            document.getElementById('currentBalanceAmount').textContent = formatAmount(currentBalance);
        }

        /** ìƒˆ ìˆ˜ì…/ì§€ì¶œ ë‚´ì—­ì„ ì¶”ê°€í•©ë‹ˆë‹¤. */
        function addBudgetItem() {
            const type = document.querySelector('input[name="transactionType"]:checked')?.value;
            const amountInput = document.getElementById('transactionAmount');
            const memoInput = document.getElementById('transactionMemo');

            const amount = parseInt(amountInput.value);
            const memo = memoInput.value.trim();

            if (!type || isNaN(amount) || amount <= 0 || memo === '') {
                showToast('ê±°ë˜ ìœ í˜•, ê¸ˆì•¡(ì–‘ìˆ˜), ë©”ëª¨ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            const newId = budgetHistory.length > 0 ? Math.max(...budgetHistory.map(b => b.id)) + 1 : 1;
            const date = new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });

            budgetHistory.push({ id: newId, type, amount, memo, date });

            amountInput.value = '';
            memoInput.value = '';
            
            saveState();
            renderBudgetPage();
            showToast(`${type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'} ${amount.toLocaleString('ko-KR')}ì›ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        /** ê±°ë˜ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. */
        function renderHistoryList() {
            const historyListEl = document.getElementById('historyList');
            if (!historyListEl) return;
            historyListEl.innerHTML = '';

            if (budgetHistory.length === 0) {
                historyListEl.innerHTML = '<div class="empty-message">ê¸°ë¡ëœ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // ìµœì‹ ìˆœ 10ê°œë§Œ í‘œì‹œ
            budgetHistory.slice().reverse().slice(0, 10).forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'history-item';
                
                const amountClass = item.type === 'income' ? 'income' : 'expense';
                const sign = item.type === 'income' ? '+' : '-';

                itemEl.innerHTML = `
                    <div class="history-info">
                        <div class="history-date">${item.date}</div>
                        <div class="history-memo">${item.memo}</div>
                    </div>
                    <div class="history-amount ${amountClass}">${sign}${item.amount.toLocaleString('ko-KR')}</div>
                    <button class="delete-btn" onclick="deleteBudgetItem(${item.id})">âŒ</button>
                `;
                historyListEl.appendChild(itemEl);
            });
        }

        /** ê±°ë˜ ë‚´ì—­ì„ ì‚­ì œí•©ë‹ˆë‹¤. */
        function deleteBudgetItem(id) {
            showConfirmDialog(`ì •ë§ë¡œ ì´ ê±°ë˜ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì”ì•¡ì— ë°”ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤)`, (confirmed) => {
                if (confirmed) {
                    budgetHistory = budgetHistory.filter(item => item.id !== id);
                    saveState();
                    renderBudgetPage();
                    showToast('ê±°ë˜ ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }, true);
        }
        
        /** ê°€ê³„ë¶€ ì°¨íŠ¸ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. (ê°„ì´ Bar Chart) */
        function renderBudgetChart() {
            const chartContainer = document.getElementById('budgetChartContainer');
            if (!chartContainer) return;
            
            // ì§€ë‚œ 7ì¼ ë°ì´í„° ì¤€ë¹„
            const last7Days = Array(7).fill(0).map((_, i) => {
                const d = new Date();
                d.setDate(d.getDate() - i);
                return {
                    date: d.toLocaleDateString('ko-KR', { month: '2-digit', day: '2-digit' }).replace('.', '/'),
                    dateKey: d.toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' })
                };
            }).reverse();

            const dailyData = last7Days.map(day => {
                const todayHistory = budgetHistory.filter(item => item.date === day.dateKey);
                const dailyIncome = todayHistory.filter(item => item.type === 'income').reduce((sum, item) => sum + item.amount, 0);
                const dailyExpense = todayHistory.filter(item => item.type === 'expense').reduce((sum, item) => sum + item.amount, 0);
                return { ...day, income: dailyIncome, expense: dailyExpense };
            });

            // ì°¨íŠ¸ ë Œë”ë§ì„ ìœ„í•œ ìµœëŒ€ê°’ ê³„ì‚°
            const maxAmount = Math.max(...dailyData.map(d => Math.max(d.income, d.expense))) || 10000;
            const chartHeight = 200;
            
            // SVG ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
            chartContainer.innerHTML = `
                <svg class="chart-canvas" viewBox="0 0 100 200" preserveAspectRatio="none">
                    <line x1="0" y1="${chartHeight}" x2="100" y2="${chartHeight}" stroke="#E0E0E0" stroke-width="0.5"/>
                    <g id="chart-bars"></g>
                </svg>
            `;
            const chartBars = document.getElementById('chart-bars');
            const labelsContainer = document.getElementById('chartLabels');
            labelsContainer.innerHTML = '';
            
            const barWidth = 100 / dailyData.length;

            dailyData.forEach((data, index) => {
                const xOffset = index * barWidth;
                
                // ì§€ì¶œ ë°”
                const expenseHeight = (data.expense / maxAmount) * chartHeight;
                if (data.expense > 0) {
                    chartBars.innerHTML += `
                        <rect x="${xOffset + 2}" y="${chartHeight - expenseHeight}" width="${barWidth / 2 - 2}" height="${expenseHeight}" fill="#F44336"></rect>
                    `;
                }

                // ìˆ˜ì… ë°”
                const incomeHeight = (data.income / maxAmount) * chartHeight;
                if (data.income > 0) {
                     chartBars.innerHTML += `
                        <rect x="${xOffset + barWidth / 2 + 2}" y="${chartHeight - incomeHeight}" width="${barWidth / 2 - 2}" height="${incomeHeight}" fill="#4CAF50"></rect>
                    `;
                }

                // ë¼ë²¨ (ë‚ ì§œ)
                labelsContainer.innerHTML += `
                    <span>${data.date.substring(3)}</span>
                `;
            });
        }


        // -------------------------------------------------------------------------
        // 7. ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        // -------------------------------------------------------------------------

        /** ì´ˆê¸°í™” í•¨ìˆ˜ */
        function initializeApp() {
            // 1. í…Œë§ˆ ë¡œë“œ
            loadTheme();
            
            // 2. ì´ˆê¸° í˜ì´ì§€ ë¡œë“œ (ê¸°ë³¸ì€ mainPage)
            goToPage('mainPage');
            
            // 3. í˜ì´ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            document.addEventListener('click', (e) => {
                // ëª¨ë‹¬ ë‹«ê¸° (ë°°ê²½ í´ë¦­ ì‹œ)
                if (e.target.classList.contains('diary-modal')) {
                    closeDiaryModal();
                }
            });
        }

        // ì „ì—­ìœ¼ë¡œ ì‚¬ìš©í•  í•¨ìˆ˜ë“¤ì„ window ê°ì²´ì— ì—°ê²° (HTMLì—ì„œ onclickìœ¼ë¡œ í˜¸ì¶œí•˜ê¸° ìœ„í•¨)
        window.goToPage = goToPage;
        window.changeTheme = changeTheme;
        window.addTask = addTask;
        window.toggleTask = toggleTask;
        window.deleteTask = deleteTask;
        window.updateScore = updateScore;
        window.showResetInfo = showResetInfo;
        window.resetAllTasks = resetAllTasks;
        window.saveDiary = saveDiary;
        window.editDiary = editDiary;
        window.viewDiary = viewDiary;
        window.deleteDiary = deleteDiary;
        window.closeDiaryModal = closeDiaryModal;
        window.clearDiaryForm = clearDiaryForm;
        window.addBudgetItem = addBudgetItem;
        window.deleteBudgetItem = deleteBudgetItem;


        // ì•±ì´ ë¡œë“œë˜ë©´ ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>